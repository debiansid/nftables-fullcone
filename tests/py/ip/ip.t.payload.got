# iif "lo" ip daddr set 127.0.0.1
ip test-ip4 input 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ immediate reg 1 0x0100007f ]
  [ payload write reg 1 => 4b @ network header + 16 csum_type 1 csum_off 10 ]

# iif "lo" ip checksum set 0
ip test-ip4 input 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ immediate reg 1 0x00000000 ]
  [ payload write reg 1 => 2b @ network header + 10 csum_type 1 csum_off 10 ]

# iif "lo" ip id set 0
ip test-ip4 input 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ immediate reg 1 0x00000000 ]
  [ payload write reg 1 => 2b @ network header + 4 csum_type 1 csum_off 10 ]

# iif "lo" ip ecn set 1
ip test-ip4 input 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ payload load 2b @ network header + 0 => reg 1 ]
  [ bitwise reg 1 = (reg=1 & 0x0000fcff ) ^ 0x00000100 ]
  [ payload write reg 1 => 2b @ network header + 0 csum_type 1 csum_off 10 ]

# iif "lo" ip ecn set ce
ip test-ip4 input 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ payload load 2b @ network header + 0 => reg 1 ]
  [ bitwise reg 1 = (reg=1 & 0x0000fcff ) ^ 0x00000300 ]
  [ payload write reg 1 => 2b @ network header + 0 csum_type 1 csum_off 10 ]

# iif "lo" ip dscp set af23
ip test-ip4 input 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ payload load 2b @ network header + 0 => reg 1 ]
  [ bitwise reg 1 = (reg=1 & 0x000003ff ) ^ 0x00005800 ]
  [ payload write reg 1 => 2b @ network header + 0 csum_type 1 csum_off 10 ]

# iif "lo" ip dscp set cs0
ip test-ip4 input 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ payload load 2b @ network header + 0 => reg 1 ]
  [ bitwise reg 1 = (reg=1 & 0x000003ff ) ^ 0x00000000 ]
  [ payload write reg 1 => 2b @ network header + 0 csum_type 1 csum_off 10 ]

# ip daddr != 192.168.0.1-192.168.0.250
netdev test-netdev ingress 
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x00000008 ]
  [ payload load 4b @ network header + 16 => reg 1 ]
  [ range neq reg 1 0x0100a8c0 0xfa00a8c0 ]

# ip daddr != 192.168.1.2-192.168.1.55
netdev test-netdev ingress 
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x00000008 ]
  [ payload load 4b @ network header + 16 => reg 1 ]
  [ range neq reg 1 0x0201a8c0 0x3701a8c0 ]

# ip saddr != 192.168.1.3-192.168.33.55
netdev test-netdev ingress 
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x00000008 ]
  [ payload load 4b @ network header + 12 => reg 1 ]
  [ range neq reg 1 0x0301a8c0 0x3721a8c0 ]

# ip daddr != 192.168.0.1-192.168.0.250
netdev test-netdev ingress 
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x00000008 ]
  [ payload load 4b @ network header + 16 => reg 1 ]
  [ range neq reg 1 0x0100a8c0 0xfa00a8c0 ]

# ip daddr != 192.168.1.2-192.168.1.55
netdev test-netdev ingress 
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x00000008 ]
  [ payload load 4b @ network header + 16 => reg 1 ]
  [ range neq reg 1 0x0201a8c0 0x3701a8c0 ]

# ip saddr != 192.168.1.3-192.168.33.55
netdev test-netdev ingress 
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x00000008 ]
  [ payload load 4b @ network header + 12 => reg 1 ]
  [ range neq reg 1 0x0301a8c0 0x3721a8c0 ]

# ip daddr != 192.168.0.1-192.168.0.250
netdev test-netdev ingress 
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x00000008 ]
  [ payload load 4b @ network header + 16 => reg 1 ]
  [ range neq reg 1 0x0100a8c0 0xfa00a8c0 ]

# iif "lo" ip daddr set 127.0.0.1
ip test-ip4 input 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ immediate reg 1 0x0100007f ]
  [ payload write reg 1 => 4b @ network header + 16 csum_type 1 csum_off 10 csum_flags 0x1 ]

# iif "lo" ip daddr set 127.0.0.1
inet test-inet input 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ meta load nfproto => reg 1 ]
  [ cmp eq reg 1 0x00000002 ]
  [ immediate reg 1 0x0100007f ]
  [ payload write reg 1 => 4b @ network header + 16 csum_type 1 csum_off 10 csum_flags 0x1 ]

# iif "lo" ip daddr set 127.0.0.1
netdev test-netdev ingress 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x00000008 ]
  [ immediate reg 1 0x0100007f ]
  [ payload write reg 1 => 4b @ network header + 16 csum_type 1 csum_off 10 csum_flags 0x1 ]

# iif "lo" ip daddr set 127.0.0.1
inet test-inet input 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ meta load nfproto => reg 1 ]
  [ cmp eq reg 1 0x00000002 ]
  [ immediate reg 1 0x0100007f ]
  [ payload write reg 1 => 4b @ network header + 16 csum_type 1 csum_off 10 csum_flags 0x1 ]

# iif "lo" ip daddr set 127.0.0.1
netdev test-netdev ingress 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x00000008 ]
  [ immediate reg 1 0x0100007f ]
  [ payload write reg 1 => 4b @ network header + 16 csum_type 1 csum_off 10 csum_flags 0x1 ]

# iif "lo" ip daddr set 127.0.0.1
netdev test-netdev ingress 
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x00000008 ]
  [ immediate reg 1 0x0100007f ]
  [ payload write reg 1 => 4b @ network header + 16 csum_type 1 csum_off 10 csum_flags 0x1 ]

