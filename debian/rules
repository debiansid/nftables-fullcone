#!/usr/bin/make -f

export DEB_BUILD_MAINT_OPTIONS = hardening=+all

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

configure_opts	:= --prefix=/usr --sysconfdir=/etc --mandir=/usr/share/man --disable-silent-rules --with-xtables

override_dh_auto_configure:
	./configure $(configure_opts) --

%:
	dh $@ --with autoreconf

override_dh_fixperms:
	dh_fixperms
	chmod a+x debian/nftables/etc/nftables.conf

override_dh_systemd_enable:
	dh_systemd_enable --no-enable

override_dh_systemd_start:
	dh_systemd_start --no-start

# https://wiki.debian.org/DebugPackage
.PHONY: override_dh_strip
override_dh_strip:
	dh_strip --dbgsym-migration='nftables-dbg (<< 0.7~)'

override_dh_auto_install:
	dh_auto_install --destdir=debian/nftables

	# upstream examples are installed in by the 'install' target to '/etc/nftables'
	mkdir -p debian/nftables/usr/share/doc/nftables/examples/syntax
	mv debian/nftables/etc/nftables/* debian/nftables/usr/share/doc/nftables/examples/syntax/
	rm -rf debian/nftables/etc/nftables

override_dh_installdocs:
	dh_installdocs --link-doc=nftables

override_dh_installinit:
	# dh_installinit will try to mess with /etc/init.d/nftables in
	# the maintainer scripts, but we don't ship it
	dh_installinit -n
